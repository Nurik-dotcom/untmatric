extends RefCounted
class_name NetworkTraceErrors

const SHORT_MESSAGES: Dictionary = {
	"": "",
	"A_WRONG_EVIDENCE": "Соберите достаточно улик перед запуском.",
	"A_L1_ШИРОКОВЕЩАТЕЛЬНЫЙ АДРЕС": "Хаб дублирует кадры на все порты. Сегмент остаётся шумным.",
	"A_L2_SEGMENT_LIMIT": "Коммутатор не маршрутизирует между подсетями.",
	"A_L1_PHYSICAL": "Репитер только усиливает сигнал.",
	"A_PASSIVE": "Патч-панель — пассивная коммутация.",
	"B_MATH_X8": "Байты не переведены в биты.",
	"B_MATH_1024": "Пропущен двоичный множитель 1024.",
	"B_MATH_DIV": "Скорость нужно делить на время.",
	"B_UNIT_TRAP": "Требуемая единица — бит/с, а не кбит/с.",
	"B_PIPELINE_INCOMPLETE": "Соберите и запустите конвейер перед ответом.",
	"B_PIPELINE_BAD_DROP": "Модуль не подходит к этому слоту.",
	"B_PIPELINE_MISMATCH": "Ответ выбран при неверном конвейере.",
	"B_SPAM_TRACE": "Обнаружен спам-команд трассировки.",
	"B_GARBAGE": "Результат не совпадает с моделью передачи.",
	"C_MASK_VAL": "Значение маски не является адресом сети.",
	"C_NOT_APPLIED": "Сначала примените AND, затем выбирайте ответ.",
	"C_L24_FALLBACK": "Автоподстановка /24 здесь неверна.",
	"C_BOUNDARY_SHIFT": "Граница подсети сдвинута.",
	"C_ШИРОКОВЕЩАТЕЛЬНЫЙ АДРЕС": "Выбран широковещательный адрес.",
	"C_BAD_STEP": "Шаг подсети вычислен неверно.",
	"C_BAD_DROP": "Маску нужно поместить в строку «МАСКА».",
	"TIMEOUT": "Время вышло.",
	"UNKNOWN": "Неверный вариант для текущего контекста."
}

const DETAIL_MESSAGES: Dictionary = {
	"A_WRONG_EVIDENCE": [
		"Порог по уликам предотвращает случайный перебор.",
		"Сначала выберите обязательные лог-улики."
	],
	"A_L1_ШИРОКОВЕЩАТЕЛЬНЫЙ АДРЕС": [
		"Хаб отправляет копии кадров на все порты.",
		"Для сегментации L2 нужен коммутатор, для подсетей — маршрутизатор."
	],
	"A_L2_SEGMENT_LIMIT": [
		"Коммутатор пересылает по MAC внутри одного широковещательного домена.",
		"Трафик между подсетями требует маршрутизатора или L3-коммутатора."
	],
	"A_L1_PHYSICAL": [
		"Репитер только восстанавливает мощность сигнала.",
		"Он не анализирует адреса и не применяет правила."
	],
	"A_PASSIVE": [
		"Патч-панель — это точка коммутации кабелей.",
		"Она не фильтрует и не маршрутизирует трафик."
	],
	"B_MATH_X8": [
		"Формула скорости: биты/время.",
		"Сначала переведите байты в биты, умножив на 8."
	],
	"B_MATH_1024": [
		"Двоичные единицы хранения используют 1024.",
		"Когда нужна двоичная конверсия, используйте множители KiB и MiB."
	],
	"B_MATH_DIV": [
		"Пропускная способность — это общее число бит, делённое на секунды передачи.",
		"Без деления результат получается завышенным."
	],
	"B_UNIT_TRAP": [
		"Ответ должен точно совпадать с требуемой единицей.",
		"Если требуется бит/с, не подставляйте кбит/с."
	],
	"B_PIPELINE_INCOMPLETE": [
		"Панель ответов открывается только после КАЛЬКУЛЯЦИИ.",
		"Сначала выберите основание, шаг байт->бит и деление на время."
	],
	"B_PIPELINE_BAD_DROP": [
		"Каждый слот принимает только свою категорию модуля.",
		"Сопоставьте slot_type модуля с подписью разъёма."
	],
	"B_PIPELINE_MISMATCH": [
		"Финальный ответ можно угадать даже при неверной сборке.",
		"Проверьте этапы конвейера, чтобы избежать ошибок единиц и формулы."
	],
	"B_SPAM_TRACE": [
		"Частые быстрые клики снижают надёжность.",
		"Дождитесь окончания кулдауна перед повторным запуском."
	],
	"B_GARBAGE": [
		"Выбранное число не соответствует конвейеру преобразования.",
		"Проверьте каждую операцию перед выбором финального ответа."
	],
	"C_MASK_VAL": [
		"Маска сама по себе не является ID сети.",
		"Вычисляйте сеть как IP И маска."
	],
	"C_NOT_APPLIED": [
		"Варианты ответа заблокированы, пока не выполнен операция И.",
		"Сначала установите маску и выполните операцию И."
	],
	"C_L24_FALLBACK": [
		"Только маски /24 по умолчанию дают границу .0.",
		"Для остальных масок используйте реальный размер блока."
	],
	"C_BOUNDARY_SHIFT": [
		"Размер блока берётся из последнего октета маски, отличного от 255.",
		"ID сети — ближайшая нижняя граница блока."
	],
	"C_ШИРОКОВЕЩАТЕЛЬНЫЙ АДРЕС": [
		"Широковещательный адрес — верхняя граница подсети.",
		"ID сети — нижняя граница."
	],
	"C_BAD_STEP": [
		"Шаг равен 256 минус значение маски в последнем октете.",
		"Используйте начала сегментов по этому шагу."
	],
	"C_BAD_DROP": [
		"Карту маски нужно помещать в зону сброса строки «МАСКА».",
		"Зона сброса отклоняет неподходящие объекты."
	],
	"TIMEOUT": [
		"Временной режим достиг лимита.",
		"Используйте быстрые преобразования единиц и проверку границ."
	],
	"UNKNOWN": [
		"Вариант не удовлетворяет условиям задачи.",
		"Перепроверьте контекст и выберите единственное корректное совпадение."
	]
}

const TITLES: Dictionary = {
	"A_WRONG_EVIDENCE": "ТРЕБУЮТСЯ УЛИКИ",
	"A_L1_ШИРОКОВЕЩАТЕЛЬНЫЙ АДРЕС": "ШТОРМ ШИРОКОВЕЩАНИЯ",
	"A_L2_SEGMENT_LIMIT": "ОГРАНИЧЕНИЕ L2",
	"A_L1_PHYSICAL": "ТОЛЬКО ФИЗИЧЕСКИЙ УРОВЕНЬ",
	"A_PASSIVE": "ПАССИВНЫЙ КОМПОНЕНТ",
	"B_MATH_X8": "ОШИБКА ПЕРЕВОДА В БИТЫ",
	"B_MATH_1024": "ОШИБКА ДВОИЧНОЙ ЕДИНИЦЫ",
	"B_MATH_DIV": "ОШИБКА ФОРМУЛЫ СКОРОСТИ",
	"B_UNIT_TRAP": "НЕСОВПАДЕНИЕ ЕДИНИЦ",
	"B_PIPELINE_INCOMPLETE": "КОНВЕЙЕР НЕ ЗАВЕРШЁН",
	"B_PIPELINE_BAD_DROP": "НЕВЕРНАЯ ЗОНА СБРОСА",
	"B_PIPELINE_MISMATCH": "НЕСОВПАДЕНИЕ КОНВЕЙЕРА",
	"B_SPAM_TRACE": "СПАМ ТРАССИРОВКИ",
	"B_GARBAGE": "НЕКОРРЕКТНЫЙ РЕЗУЛЬТАТ",
	"C_MASK_VAL": "ПУТАНИЦА С МАСКОЙ",
	"C_NOT_APPLIED": "ОПЕРАЦИЯ И НЕ ПРИМЕНЁН",
	"C_L24_FALLBACK": "ЛОВУШКА /24 ПО УМОЛЧАНИЮ",
	"C_BOUNDARY_SHIFT": "СДВИГ ГРАНИЦЫ",
	"C_ШИРОКОВЕЩАТЕЛЬНЫЙ АДРЕС": "ВЫБРАН ШИРОКОВЕЩАТЕЛЬНЫЙ АДРЕС",
	"C_BAD_STEP": "НЕВЕРНЫЙ ШАГ",
	"C_BAD_DROP": "НЕВЕРНАЯ ЗОНА СБРОСА",
	"TIMEOUT": "ТАЙМАУТ",
	"UNKNOWN": "НЕВЕРНОЕ РЕШЕНИЕ"
}

static func short_message(code: String) -> String:
	var normalized: String = code.strip_edges()
	if SHORT_MESSAGES.has(normalized):
		return str(SHORT_MESSAGES[normalized])
	return str(SHORT_MESSAGES["UNKNOWN"])

static func get_error_title(code: String) -> String:
	var normalized: String = code.strip_edges()
	if TITLES.has(normalized):
		return str(TITLES[normalized])
	return str(TITLES["UNKNOWN"])

static func get_error_tip(code: String) -> String:
	return short_message(code)

static func detail_messages(code: String) -> Array[String]:
	var normalized: String = code.strip_edges()
	var source: Array = []
	if DETAIL_MESSAGES.has(normalized):
		source = DETAIL_MESSAGES[normalized]
	else:
		source = DETAIL_MESSAGES["UNKNOWN"]
	var details: Array[String] = []
	for line_var in source:
		details.append(str(line_var))
	return details

